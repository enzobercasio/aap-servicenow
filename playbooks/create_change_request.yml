---
- name: Create an Incident using ServiceNow ITSM Collection
  hosts: localhost
  gather_facts: false

  vars_files:
    - ../vars/servicenow_vars.yml

  tasks:
    - name: Create incident via servicenow.itsm.change_request module
      servicenow.itsm.change_request:
        instance:
          host: "https://{{ snow_instance }}.service-now.com"
          username: "{{ snow_username }}"
          password: "{{ snow_password }}"
        
        type: standard
        state: new
        short_description: Install new Cisco
        description: Please install new Cat. 6500 in Data center 01
        attachments:
         - path: path/to/attachment.txt
        priority: moderate
        risk: low
        impact: low

        other:
          expected_start: 2021-02-12
      register: result

    - name: Show the change request number
      debug:
        msg: "Change Request created: {{ result.record.number }}"